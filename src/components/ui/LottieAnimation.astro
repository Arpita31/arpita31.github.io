---
export interface Props {
  animationPath: string;
  width?: string;
  height?: string;
  class?: string;
}

const { 
  animationPath, 
  width = '100%', 
  height = '400px', 
  class: className = '' 
} = Astro.props;
---

<div 
  id="lottie-container" 
  class={`lottie-animation ${className}`}
  style={`width: ${width}; height: ${height};`}
  data-animation-path={animationPath}
>
</div>

<script>
  function loadLottieAnimation() {
    const script = document.createElement('script');
    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js';
    script.onload = function() {
      const container = document.getElementById('lottie-container');
      if (container && window.lottie) {
        const animationPath = container.dataset.animationPath;
        const animation = window.lottie.loadAnimation({
          container: container,
          renderer: 'svg',
          loop: true,
          autoplay: true,
          path: animationPath
        });

        container.addEventListener('mouseenter', () => {
          animation.setSpeed(1.5);
        });

        container.addEventListener('mouseleave', () => {
          animation.setSpeed(1);
        });

        animation.addEventListener('data_failed', () => {
          container.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 4rem;">👨‍💻</div>';
        });
      }
    };
    script.onerror = function() {
      const container = document.getElementById('lottie-container');
      if (container) {
        container.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 4rem;">👨‍💻</div>';
      }
    };
    document.head.appendChild(script);
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadLottieAnimation);
  } else {
    loadLottieAnimation();
  }
</script>